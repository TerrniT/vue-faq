import{_ as s,o as n,c as a,Q as p}from"./chunks/framework.46d06b6e.js";const d=JSON.parse('{"title":"Github Actions","description":"","frontmatter":{},"headers":[],"relativePath":"ru/deployment/github-actions.md","filePath":"ru/deployment/github-actions.md","lastUpdated":1701857879000}'),l={name:"ru/deployment/github-actions.md"},o=p(`<h1 id="github-actions" tabindex="-1">Github Actions <a class="header-anchor" href="#github-actions" aria-label="Permalink to &quot;Github Actions&quot;">‚Äã</a></h1><details class="details custom-block"><summary>–ß—Ç–æ —Ç–∞–∫–æ–µ GitHub Actions?</summary><p><code>GitHub Actions</code> —Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –∏ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±–∏–ª–¥–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, —Ç–∞–∫ —á—Ç–æ —Å–æ–≤–µ—Ç—É–µ—Ç—Å—è –∏—Ö –∏–∑—É—á–∏—Ç—å –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–∞–∫ –≤ –ø–µ—Ç, —Ç–∞–∫ –∏ –≤ –±–æ–ª—å—à–∏—Ö –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.</p><p>–í–∞—à –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ GitHub, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.</p><p>–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Ñ–∞–π–ª <code>.github/workflows/deploy.yaml</code> (–∏–º—è —Å–∞–º–æ–≥–æ —Ñ–∞–π–ª–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º)</p><p>–í –Ω–µ–º –±—É–¥—É—Ç GitHub Actions –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.</p></details><details class="details custom-block"><summary>GitHub Actions - –ø—Ä–∏–º–µ—Ä –¥–µ–ø–ª–æ—è –Ω–∞ GitHub Pages</summary><p>–û–±—Ä–∞–∑–µ—Ü –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (Vue-Faq) —Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –Ω–∞ Github Pages</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># .github/workflows/deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Build and Deploy</span></span>
<span class="line"><span style="color:#79B8FF;">on</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">push</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">branches</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#85E89D;">permissions</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">contents</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">write</span></span>
<span class="line"><span style="color:#85E89D;">jobs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">build-and-deploy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">runs-on</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">steps</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Checkout üõéÔ∏è</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Install pnpm</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm-install</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8.5.0</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">run_install</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">run</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">run</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deploy üöÄ</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">JamesIves/github-pages-deploy-action@v4</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">folder</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">docs/.vitepress/dist</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">branch</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">gh-pages</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># .github/workflows/deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Build and Deploy</span></span>
<span class="line"><span style="color:#005CC5;">on</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">push</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">branches</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">main</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#22863A;">permissions</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">contents</span><span style="color:#24292E;">: </span><span style="color:#032F62;">write</span></span>
<span class="line"><span style="color:#22863A;">jobs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">build-and-deploy</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">runs-on</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ubuntu-latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">steps</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Checkout üõéÔ∏è</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">actions/checkout@v3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Install pnpm</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm-install</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">version</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8.5.0</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">run_install</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Install dependencies</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deploy üöÄ</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">JamesIves/github-pages-deploy-action@v4</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">folder</span><span style="color:#24292E;">: </span><span style="color:#032F62;">docs/.vitepress/dist</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">branch</span><span style="color:#24292E;">: </span><span style="color:#032F62;">gh-pages</span></span></code></pre></div><p>–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—É—à–∞ –≤ <code>main</code> –≤–µ—Ç–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Å–∞–π—Ç–∞ –Ω–∞ GitHub Pages.</p><p>–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–∏ GitHub Actions: <code>actions/checkout@v3</code> –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏–∑ –≤–µ—Ç–∫–∏ <code>main</code>, <code>pnpm/action-setup@v2</code> –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ <code>pnpm</code> –º–µ–Ω–µ–¥–∂–µ—Ä–∞, <code>JamesIves/github-pages-deploy-action@v4</code> –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–ª–¥–∞ –≤ <code>gh-pages</code> –≤–µ—Ç–∫—É –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ —É–∂–µ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞). –í–∞—à GitHub –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —á—Ç–æ–±—ã GitHub Pages –±—Ä–∞–ª–∏ —Ñ–∞–π–ª—ã –∏–∑ —ç—Ç–æ–π –≤–µ—Ç–∫–∏ (<code>Settings-&gt;Pages</code>).</p><p>–í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ GitHub Pages –æ–ø–∏—Å–∞–Ω –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ Github Actions, –Ω–æ <code>JamesIves/github-pages-deploy-action@v4</code>–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∂–∏–∑–Ω—å.</p></details><details class="details custom-block"><summary>GitHub Actions - –ø—Ä–∏–º–µ—Ä –¥–µ–ø–ª–æ—è –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –ø–æ SSH</summary><p>–ë–æ–ª–µ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Å–ª—É—á–∞–π –ø–æ–ª–µ–∑–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ CI/CD.</p><p>–£ –Ω–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–∫—Ä—É–∂–µ–Ω–∏–π (<code>dev</code>, <code>staging</code>, <code>prod</code>) –∏ –Ω—É–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ (–∏—Å–ø–æ–ª—å–∑—É—è <code>workflow_dispatch</code>) –≤ –Ω—É–∂–Ω–æ–µ –ø–æ –≤—ã–±–æ—Ä—É –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å–æ —Å–≤–æ–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –ü–ª—é—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ <code>dev</code> –ø—Ä–∏ <code>git push</code>.</p><p>–î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Å–≤–æ–π <code>.env</code> —Ñ–∞–π–ª - <code>.env.dev</code>, <code>.env.staging</code> –∏ <code>.env.prod</code>, –∏ –∫–∞–∂–¥–æ–º—É –æ–∫—Ä—É–∂–µ–Ω–∏—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–≤–æ—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ - <code>dev.your-site.com</code>, <code>staging.your-site.com</code> –∏ <code>your-site.com</code>.</p><p>–ö—Ä–æ–º–µ —Ç–æ–≥–æ, —Ç–∞–º –∂–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è <code>backup</code> —Å –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏ <code>dev</code>, <code>staging</code> –∏ <code>prod</code>. –ü—Ä–∏ –¥–µ–ø–ª–æ–µ –º—ã –±—É–¥–µ–º –±—ç–∫–∞–ø–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–º 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.</p><p>–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –º—ã –±—É–¥–µ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª <code>build.json</code> —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –∏–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –û–Ω –Ω—É–∂–µ–Ω –∫–∞–∫ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ª–∏, —Ç–∞–∫ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–æ–º —Ñ–∞–π–ª–∞ <code>index.html</code> –∏ –ø–æ–∫–∞–∑—ã–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ —Å–∞–π—Ç–∞ –ø–æ—Å–ª–µ –µ–≥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ø–¥–µ–π—Ç–∞. –û–¥–Ω–æ –∏–∑ —Ä–µ—à–µ–Ω–∏–π - –≤–µ–±—Å–∞–π—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–∫–∞—á–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞—Ç—É –≤ –Ω–µ–º —Å —Ç–æ–π, –∫–æ—Ç–æ—Ä—É—é –æ–Ω —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª –≤ localStorage. –ï—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, —Ç–æ —Å–∞–π—Ç —Ñ–æ—Ä—Å–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É <code>index.html</code> –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∞–π–º—Å—Ç–µ–º–ø–∞. –ü–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞–¥–µ–∂–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ–±—Å–∞–π—Ç–∞.</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">localStorageName</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;BUILD_DATE&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/build.json?version&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">response</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  response.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">buildData</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (buildData.date </span><span style="color:#F97583;">!==</span><span style="color:#E1E4E8;"> localStorage.</span><span style="color:#B392F0;">getItem</span><span style="color:#E1E4E8;">(localStorageName)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Updating. New version:&quot;</span><span style="color:#E1E4E8;">, buildData.date);</span></span>
<span class="line"><span style="color:#E1E4E8;">      localStorage.</span><span style="color:#B392F0;">setItem</span><span style="color:#E1E4E8;">(localStorageName, buildData.date);</span></span>
<span class="line"><span style="color:#E1E4E8;">      window.location.</span><span style="color:#B392F0;">reload</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Exiting for update&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">localStorageName</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;BUILD_DATE&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">fetch</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/build.json?version&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">((</span><span style="color:#E36209;">response</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  response.</span><span style="color:#6F42C1;">json</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">((</span><span style="color:#E36209;">buildData</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (buildData.date </span><span style="color:#D73A49;">!==</span><span style="color:#24292E;"> localStorage.</span><span style="color:#6F42C1;">getItem</span><span style="color:#24292E;">(localStorageName)) {</span></span>
<span class="line"><span style="color:#24292E;">      console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Updating. New version:&quot;</span><span style="color:#24292E;">, buildData.date);</span></span>
<span class="line"><span style="color:#24292E;">      localStorage.</span><span style="color:#6F42C1;">setItem</span><span style="color:#24292E;">(localStorageName, buildData.date);</span></span>
<span class="line"><span style="color:#24292E;">      window.location.</span><span style="color:#6F42C1;">reload</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Exiting for update&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç—Ä–∏ –Ω–æ–≤—ã—Ö Github Actions: <code>appleboy/ssh-action@master</code> –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ, <code>easingthemes/ssh-deploy@main</code> –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ö–æ—Å—Ç, –∏ <code>snickerbockers/submodules-init@v4</code> - –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞—à –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Git Submodules</p><p>–ö—Ä–æ–º–µ —Ç–æ–≥–æ –Ω–∞–¥–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ Github Secrets <code>SERVER_SSH_KEY</code> - –∑–∞–∫—Ä—ã—Ç—ã–π –∫–ª—é—á –¥–ª—è SSH –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ö–æ—Å—Ç.</p><details class="details custom-block"><summary>deploy.yaml</summary><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># .github/workflows/deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Build and deploy</span></span>
<span class="line"><span style="color:#79B8FF;">on</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">push</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">branches</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">workflow_dispatch</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">inputs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">target</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Target</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">required</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">default</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">choice</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">options</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">staging</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">prod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">jobs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">build-and-deploy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">runs-on</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ubuntu-latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">TARGET</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ inputs.target }}</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">HOST</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">your-site.com</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">TARGET_DIR</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ format(&#39;/var/www/your-site/{0}.your-site.com&#39;, inputs.target) }}</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">PROJECT_DIR</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ format(&#39;{0}.your-site.com&#39;, inputs.target) }}</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">REMOTE_USER</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ubuntu</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">SSH_PRIVATE_KEY</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ secrets.SERVER_SSH_KEY }}</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">ENV_FILE</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ format(&#39;.env.{0}&#39;, inputs.target) }}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">steps</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Setting the environment</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">run</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">          echo $TARGET</span></span>
<span class="line"><span style="color:#9ECBFF;">          # deploy on Dev by default</span></span>
<span class="line"><span style="color:#9ECBFF;">          if [[ $TARGET == &quot;&quot; ]]</span></span>
<span class="line"><span style="color:#9ECBFF;">          then</span></span>
<span class="line"><span style="color:#9ECBFF;">            echo &quot;TARGET_DIR=/var/www/your-site/dev.your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#9ECBFF;">            echo &quot;PROJECT_DIR=dev.your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#9ECBFF;">            echo &quot;ENV_FILE=.env.dev&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#9ECBFF;">          fi          </span></span>
<span class="line"><span style="color:#9ECBFF;">          if [[ $TARGET == &quot;prod&quot; ]]</span></span>
<span class="line"><span style="color:#9ECBFF;">          then</span></span>
<span class="line"><span style="color:#9ECBFF;">            echo &quot;TARGET_DIR=/var/www/your-site/your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#9ECBFF;">            echo &quot;PROJECT_DIR=your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#9ECBFF;">          fi</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">run</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">          echo &quot;target dir: $TARGET_DIR&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">          echo &quot;project dir: $PROJECT_DIR&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">actions/checkout@v3</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">submodules</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">recursive</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">snickerbockers/submodules-init@v4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">actions/setup-node@v3</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">node-version</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Install pnpm</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm-install</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8.5.0</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">run_install</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Install dependencies</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">run</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">run</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mv $ENV_FILE .env</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">run</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pnpm build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Clean up the server dir</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">appleboy/ssh-action@master</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.HOST }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.REMOTE_USER }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">envs</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TARGET_DIR</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sudo rm -rf $TARGET_DIR; mkdir $TARGET_DIR</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Transfer files</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">easingthemes/ssh-deploy@main</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">SSH_PRIVATE_KEY</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">REMOTE_HOST</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.HOST }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">REMOTE_USER</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.REMOTE_USER }}</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">SOURCE</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dist/</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">TARGET</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.TARGET_DIR }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">EXCLUDE</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;.git, .github, .vscode, *.md, *.yaml, *.sql, .gitignore&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">After deploy scripts</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">uses</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">appleboy/ssh-action@master</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">with</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.HOST }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.REMOTE_USER }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">\${{ env.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">envs</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TARGET_DIR,REMOTE_USER,PROJECT_DIR</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">            cd $TARGET_DIR</span></span>
<span class="line"><span style="color:#9ECBFF;">            pwd</span></span>
<span class="line"><span style="color:#9ECBFF;">            sudo chgrp -R www-data * .*</span></span>
<span class="line"><span style="color:#9ECBFF;">            backup_date=\`date &quot;+%Y-%m-%d__%H-%M-%S&quot;\`;</span></span>
<span class="line"><span style="color:#9ECBFF;">            printf &quot;{\\&quot;website\\&quot;: \\&quot;$PROJECT_DIR\\&quot;, \\&quot;date\\&quot;: \\&quot;$backup_date\\&quot;}&quot; &gt; build.json</span></span>
<span class="line"><span style="color:#9ECBFF;">            # -------------------</span></span>
<span class="line"><span style="color:#9ECBFF;">            root_backup_dir=\`echo &quot;/var/www/your-site/backup/$PROJECT_DIR&quot;\`;</span></span>
<span class="line"><span style="color:#9ECBFF;">            backup_dir=\`echo &quot;$root_backup_dir/$backup_date&quot;\`;</span></span>
<span class="line"><span style="color:#9ECBFF;">            mkdir $backup_dir -p;</span></span>
<span class="line"><span style="color:#9ECBFF;">            cp -rf $TARGET_DIR/* $backup_dir;</span></span>
<span class="line"><span style="color:#9ECBFF;">            sudo chgrp -R www-data $backup_dir;</span></span>
<span class="line"><span style="color:#9ECBFF;">            backups_remove_count=5;</span></span>
<span class="line"><span style="color:#9ECBFF;">            cd $backup_dir &amp;&amp; rm -rf work logs images;</span></span>
<span class="line"><span style="color:#9ECBFF;">            cd $root_backup_dir &amp;&amp; dirs_to_be_removed=\`ls -dt &quot;$root_backup_dir/&quot;* | tail -n +$backups_remove_count\`;</span></span>
<span class="line"><span style="color:#9ECBFF;">            rm $dirs_to_be_removed -rf;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># .github/workflows/deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Build and deploy</span></span>
<span class="line"><span style="color:#005CC5;">on</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">push</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">branches</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">main</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">workflow_dispatch</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">inputs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">target</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Target</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">required</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">default</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">choice</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">options</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#032F62;">staging</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#032F62;">prod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">jobs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">build-and-deploy</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">runs-on</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ubuntu-latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">TARGET</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ inputs.target }}</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">HOST</span><span style="color:#24292E;">: </span><span style="color:#032F62;">your-site.com</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">TARGET_DIR</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ format(&#39;/var/www/your-site/{0}.your-site.com&#39;, inputs.target) }}</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">PROJECT_DIR</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ format(&#39;{0}.your-site.com&#39;, inputs.target) }}</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">REMOTE_USER</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ubuntu</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">SSH_PRIVATE_KEY</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ secrets.SERVER_SSH_KEY }}</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">ENV_FILE</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ format(&#39;.env.{0}&#39;, inputs.target) }}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">steps</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Setting the environment</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#032F62;">          echo $TARGET</span></span>
<span class="line"><span style="color:#032F62;">          # deploy on Dev by default</span></span>
<span class="line"><span style="color:#032F62;">          if [[ $TARGET == &quot;&quot; ]]</span></span>
<span class="line"><span style="color:#032F62;">          then</span></span>
<span class="line"><span style="color:#032F62;">            echo &quot;TARGET_DIR=/var/www/your-site/dev.your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#032F62;">            echo &quot;PROJECT_DIR=dev.your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#032F62;">            echo &quot;ENV_FILE=.env.dev&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#032F62;">          fi          </span></span>
<span class="line"><span style="color:#032F62;">          if [[ $TARGET == &quot;prod&quot; ]]</span></span>
<span class="line"><span style="color:#032F62;">          then</span></span>
<span class="line"><span style="color:#032F62;">            echo &quot;TARGET_DIR=/var/www/your-site/your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#032F62;">            echo &quot;PROJECT_DIR=your-site.com&quot; &gt;&gt; $GITHUB_ENV</span></span>
<span class="line"><span style="color:#032F62;">          fi</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#032F62;">          echo &quot;target dir: $TARGET_DIR&quot;</span></span>
<span class="line"><span style="color:#032F62;">          echo &quot;project dir: $PROJECT_DIR&quot;</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">actions/checkout@v3</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">submodules</span><span style="color:#24292E;">: </span><span style="color:#032F62;">recursive</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">snickerbockers/submodules-init@v4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">actions/setup-node@v3</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">node-version</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm/action-setup@v2</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Install pnpm</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm-install</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">version</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8.5.0</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">run_install</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Install dependencies</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mv $ENV_FILE .env</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">run</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pnpm build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Clean up the server dir</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">appleboy/ssh-action@master</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.HOST }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.REMOTE_USER }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">envs</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TARGET_DIR</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">script</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sudo rm -rf $TARGET_DIR; mkdir $TARGET_DIR</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Transfer files</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">easingthemes/ssh-deploy@main</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">SSH_PRIVATE_KEY</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">REMOTE_HOST</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.HOST }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">REMOTE_USER</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.REMOTE_USER }}</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">SOURCE</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dist/</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">TARGET</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.TARGET_DIR }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">EXCLUDE</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;.git, .github, .vscode, *.md, *.yaml, *.sql, .gitignore&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">After deploy scripts</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">uses</span><span style="color:#24292E;">: </span><span style="color:#032F62;">appleboy/ssh-action@master</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">with</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.HOST }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.REMOTE_USER }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">\${{ env.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">envs</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TARGET_DIR,REMOTE_USER,PROJECT_DIR</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">script</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#032F62;">            cd $TARGET_DIR</span></span>
<span class="line"><span style="color:#032F62;">            pwd</span></span>
<span class="line"><span style="color:#032F62;">            sudo chgrp -R www-data * .*</span></span>
<span class="line"><span style="color:#032F62;">            backup_date=\`date &quot;+%Y-%m-%d__%H-%M-%S&quot;\`;</span></span>
<span class="line"><span style="color:#032F62;">            printf &quot;{\\&quot;website\\&quot;: \\&quot;$PROJECT_DIR\\&quot;, \\&quot;date\\&quot;: \\&quot;$backup_date\\&quot;}&quot; &gt; build.json</span></span>
<span class="line"><span style="color:#032F62;">            # -------------------</span></span>
<span class="line"><span style="color:#032F62;">            root_backup_dir=\`echo &quot;/var/www/your-site/backup/$PROJECT_DIR&quot;\`;</span></span>
<span class="line"><span style="color:#032F62;">            backup_dir=\`echo &quot;$root_backup_dir/$backup_date&quot;\`;</span></span>
<span class="line"><span style="color:#032F62;">            mkdir $backup_dir -p;</span></span>
<span class="line"><span style="color:#032F62;">            cp -rf $TARGET_DIR/* $backup_dir;</span></span>
<span class="line"><span style="color:#032F62;">            sudo chgrp -R www-data $backup_dir;</span></span>
<span class="line"><span style="color:#032F62;">            backups_remove_count=5;</span></span>
<span class="line"><span style="color:#032F62;">            cd $backup_dir &amp;&amp; rm -rf work logs images;</span></span>
<span class="line"><span style="color:#032F62;">            cd $root_backup_dir &amp;&amp; dirs_to_be_removed=\`ls -dt &quot;$root_backup_dir/&quot;* | tail -n +$backups_remove_count\`;</span></span>
<span class="line"><span style="color:#032F62;">            rm $dirs_to_be_removed -rf;</span></span></code></pre></div></details></details>`,4),e=[o];function c(t,E,r,y,i,u){return n(),a("div",null,e)}const m=s(l,[["render",c]]);export{d as __pageData,m as default};
